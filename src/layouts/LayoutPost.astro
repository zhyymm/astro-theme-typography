---
import PostMeta from '~/components/PostMeta.astro'
import type { Post } from '~/types'
import Giscus from '~/components/comments/Giscus.astro'
import LayoutDefault from '~/layouts/LayoutDefault.astro'

interface Props {
  post: Post
}

const { post } = Astro.props
// 1. 判断是否为文章详情页
const isPostPage = Astro.url.pathname.startsWith('/posts/')

// 2. 获取作者信息：使用双字段逻辑
// author 是拼音（用于链接），authorName 是中文（用于显示）
const authorSlug = post.data.author || "admin"
const authorDisplayName = post.data.authorName || authorSlug
---
<article class="prose">
  <PostMeta post={post} />
  <slot />
</article>

{isPostPage && (
  <div class="mt-12 pt-8 border-t border-dashed border-zinc-200 dark:border-zinc-800">
    <div class="flex items-center gap-4">
      <div class="w-12 h-12 rounded-full bg-orange-500/5 flex items-center justify-center text-lg shadow-sm border border-orange-500/10 font-bold text-orange-500">
        {/* 截取中文名字的第一个字 */}
        {authorDisplayName.charAt(0)}
      </div>

      <div class="flex flex-col">
        <span class="text-[10px] opacity-40 uppercase tracking-widest font-bold">本文作者</span>
        <a href={`/authors/${authorSlug}/`} class="text-base font-bold hover:text-orange-500 transition-colors">
          {authorDisplayName}
        </a>
      </div>
    </div>

    <p class="text-xs opacity-50 mt-4 italic leading-relaxed">
      如法受持，如实开示。点击作者名查看更多导师详情。
    </p>
  </div>
)}

{isPostPage && (
  <section class="giscus-container mt-12">
    <Giscus />
  </section>
)}

<style is:global>
  /* 统一标题悬停颜色 */
  .post-title a, h2 a, h3 a {
    @apply transition-colors duration-300;
    color: inherit;
    text-decoration: none;
  }

  .post-title a:hover,
  h2 a:hover,
  h3 a:hover,
  .group:hover a {
    @apply text-orange-500 !important;
  }

  /* 点击背景重置 */
  .post-item:active,
  .group:active {
    background-color: transparent !important;
  }

  /* 分类/标签页符号同步变色 */
  .group:hover .opacity-30,
  .group:hover .opacity-20 {
    @apply text-orange-500 opacity-100 transition-all;
  }
</style>
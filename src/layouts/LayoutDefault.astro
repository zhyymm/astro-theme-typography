---
import { themeConfig } from '~/.config'
import SiteFooter from '~/components/SiteFooter.astro'
import SiteNavigation from '~/components/SiteNavigation.astro'
import SiteTitle from '~/components/SiteTitle.astro'
import SiteSeo from '~/components/SiteSeo.astro'
import LaTeX from '~/components/LaTeX.astro'
import Analytics from '~/components/Analytics.astro'
import ThemeScript from '~/components/ThemeScript.astro'
import '~/styles/global.css'

const lang = themeConfig.appearance.locale ?? 'en-us'
const dark = themeConfig.appearance.theme === 'dark'

// --- 核心逻辑：判断当前是否为文章详情页 ---
const isPostPage = Astro.url.pathname.includes('/posts/')
---

<html lang={lang} class:list={[{ dark }]}>
  <head>
    <slot name="seo"> <SiteSeo /> </slot>
    <LaTeX />
    <Analytics />
    <ThemeScript />
  </head>

  <body
    class="h-100vh max-w-1200px min-w-390px mx-a"
    p="7.5 lg:(y-0 x-20)"
    lg="grid gap-x-6 cols-[3fr_1fr] rows-[1fr_9rem]"
  >
    <header
      data-pagefind-ignore
      class="transition-swup-header flex flex-col gap-2.5"
      m="7.5 lg:(x-0 t-20 b-4)"
      lg="row-1-2 col-2-3 justify-between items-start"
    >
      <SiteTitle />
      <SiteNavigation />
    </header>

    {isPostPage ? (
      <main 
        data-pagefind-body
        class="transition-swup-main overflow-y-scroll scrollbar-hide outline-none" 
        lg="row-1-3 col-1-2 py-20"
      >
        <slot />
      </main>
    ) : (
      <main 
        data-pagefind-ignore
        class="transition-swup-main overflow-y-scroll scrollbar-hide outline-none" 
        lg="row-1-3 col-1-2 py-20"
      >
        <slot />
      </main>
    )}

    <footer data-pagefind-ignore class="transition-swup-footer py-7.5" lg="row-2-3 col-2-3">
      <SiteFooter />
    </footer>

    <style is:global>
  /* --- 1. 背景与基础（保持你原本满意的样式） --- */
  html {
    background-color: #ffffff;
    background-image: url('/placeholder.png') !important;
    background-repeat: repeat !important;
    background-attachment: fixed !important;
    background-size: 960px auto !important;
    image-rendering: -webkit-optimize-contrast;
  }
  html.dark { background-color: #18181b; }

  body, main, header, footer, #swup, section, article, .transition-swup-main {
    background-color: transparent !important;
    background-image: none !important;
  }

  .scrollbar-hide::-webkit-scrollbar { display: none; }

  /* 导航悬停黑底白字 */
  nav a:hover, header a:hover {
    background-color: #000000 !important;
    color: #ffffff !important;
    text-decoration: none !important;
  }

  /* --- 2. 核心布局：主容器 --- */
  main {
    padding-left: 1.5rem !important;
    padding-right: 1.5rem !important;
    max-width: 1200px !important;
    margin-left: auto !important;
    margin-right: auto !important;
  }

  /* --- 3. 电脑端精准修复：只在宽屏下移动归档标题 --- */
  @media (min-width: 1024px) {
    /* 锁定归档页标题容器 */
    main > h1:first-of-type,
    .mb-10.flex.items-end {
      /* 向右平移 2.2rem，使其视觉上与下方的文章标题完美对齐 */
      transform: translateX(2.2rem) !important;
    }
  }

  /* --- 4. 手机端专项修复：收紧底部 + 还原标题 --- */
  @media (max-width: 768px) {
    main {
      padding-left: 1rem !important;
      padding-right: 1rem !important;
      /* 解决你最关心的手机端下边距过长问题 */
      padding-bottom: 0.5rem !important; 
    }
    
    /* 强制还原标题位置，防止标题在手机上跑偏 */
    main > h1:first-of-type,
    .mb-10.flex.items-end {
      transform: translateX(0) !important;
    }

    footer {
      margin-top: 0 !important;
      padding: 1rem !important;
    }
  }
</style>
  </body>
</html>
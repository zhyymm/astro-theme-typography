---
/* JS 逻辑部分保持完全一致 */
const { prev, next, current, total, base } = Astro.props;
if (!total || total <= 1) return null;

const ensureTrailingSlash = (url: string | undefined | null) => {
  if (!url) return null;
  return url.endsWith('/') ? url : `${url}/`;
};

const normalizedBase = base.endsWith('/') ? base : `${base}/`;
const firstPageUrl = normalizedBase;
const lastPageUrl = `${normalizedBase}${total}/`.replace(/\/+/g, '/');

let start = Math.max(1, current);
let end = Math.min(total, start + 9);
if (end - start < 9) { start = Math.max(1, end - 9); }
const range = Array.from({ length: (end - start) + 1 }, (_, i) => start + i);

let prevUrl = ensureTrailingSlash(prev);
if (prevUrl && (prevUrl === `${normalizedBase}1/` || prevUrl.endsWith('/1/'))) {
  prevUrl = normalizedBase;
}
const nextUrl = ensureTrailingSlash(next);
---

<nav class="pg-container" data-pagefind-ignore>
  <div class="pg-row">
    {/* 首页：手机端只显示符号 */}
    <a href={firstPageUrl} class={`pg-btn ${current === 1 ? 'is-disabled' : ''}`}>
      <span class="pc-only">首页</span><span class="m-only">«</span>
    </a>

    {/* 上一页箭头 */}
    <a href={prevUrl} class={`pg-btn arrow ${current === 1 ? 'is-disabled' : ''}`}>
      <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="m15 18l-6-6l6-6"/></svg>
    </a>

    {/* 数字区域：强制不换行 */}
    <div class="pg-numbers">
      {range.map((num) => (
        <a
          href={num === 1 ? firstPageUrl : `${normalizedBase}${num}/`}
          class={`pg-btn num ${current === num ? 'is-active' : ''}`}
        >
          {num}
        </a>
      ))}
    </div>

    {/* 下一页箭头 */}
    <a href={nextUrl} class={`pg-btn arrow ${current === total ? 'is-disabled' : ''}`}>
      <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="m9 18l6-6l-6-6"/></svg>
    </a>

    {/* 尾页：手机端只显示符号 */}
    <a href={lastPageUrl} class={`pg-btn ${current === total ? 'is-disabled' : ''}`}>
      <span class="pc-only">尾页</span><span class="m-only">»</span>
    </a>

    {/* 页码：1/19 紧跟其后 */}
    <span class="pg-info">{current}/{total}</span>
  </div>
</nav>

<style is:global>
  .pg-container {
    /* 1. 消除顶部多余空隙，让它紧贴文章 */
    margin: 0.5rem 0 2rem 0 !important; 
    
    /* 2. 关键：将 display 改为 flex 而非 block，防止在手机端产生奇怪的占位感 */
    display: flex !important;
    width: 100% !important;
    clear: both !important;
    
    /* 3. 消除可能导致“上下移动”的溢出属性 */
    overflow: visible !important; 
    touch-action: pan-x; /* 只允许横向触摸，防止垂直滑屏时分页条抖动 */
  }

  .pg-row {
    display: flex !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    justify-content: flex-start !important;
    width: 100%;
    /* 4. 移除 overflow-x: auto，除非页码真的多到溢出屏幕 */
    /* 这样可以消除手机端那种“小窗口”内部滚动的框架感 */
    overflow: visible !important; 
  }

  /* 5. 确保在手机端没有额外的阴影或背景色干扰 */
  @media (max-width: 640px) {
    .pg-container {
      background: transparent !important;
      border: none !important;
    }
  }
</style>
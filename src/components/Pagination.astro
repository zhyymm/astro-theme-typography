---
const { prev, next, current, total, base } = Astro.props;
if (!total || total <= 1) return null;

const ensureTrailingSlash = (url: string | undefined | null) => {
  if (!url) return null;
  return url.endsWith('/') ? url : `${url}/`;
};

const normalizedBase = base.endsWith('/') ? base : `${base}/`;
const firstPageUrl = normalizedBase;
const lastPageUrl = `${normalizedBase}${total}/`.replace(/\/+/g, '/');

// --- 核心修正：路径破相，回归第一页真实路径 ---
let prevUrl = ensureTrailingSlash(prev);
if (prevUrl && (prevUrl === `${normalizedBase}1/` || prevUrl.endsWith('/1/'))) {
  prevUrl = normalizedBase;
}

const nextUrl = ensureTrailingSlash(next);
---

<nav class="flex flex-col items-center gap-5 mt-16 mb-12 font-sans">
  <div class="text-[10px] sm:text-xs uppercase tracking-[0.3em] text-zinc-400 dark:text-zinc-500 font-bold">
    Page {current} <span class="mx-1 opacity-40">/</span> {total}
  </div>

  <div class="inline-flex items-center bg-white/90 dark:bg-zinc-900/90 backdrop-blur-sm p-1.5 rounded-full border border-zinc-200 dark:border-zinc-800 shadow-sm transition-all hover:shadow-md">

    <div class="flex items-center">
      {current > 1 ? (
        <>
          <a href={firstPageUrl} class="nav-link">首页</a>
          <a href={prevUrl} class="nav-link px-3" title="上一页">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 18l-6-6l6-6"/></svg>
          </a>
        </>
      ) : (
        <>
          <span class="nav-disabled">首页</span>
          <span class="nav-disabled px-3"><svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-30" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 18l-6-6l6-6"/></svg></span>
        </>
      )}
    </div>

    <div class="w-[1px] h-5 bg-zinc-200 dark:bg-zinc-800 mx-1"></div>

    <div class="flex items-center">
      {current < total ? (
        <>
          <a href={nextUrl} class="nav-link px-3" title="下一页">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m9 18l6-6l-6-6"/></svg>
          </a>
          <a href={lastPageUrl} class="nav-link">尾页</a>
        </>
      ) : (
        <>
          <span class="nav-disabled px-3"><svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-30" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m9 18l6-6l-6-6"/></svg></span>
          <span class="nav-disabled">尾页</span>
        </>
      )}
    </div>
  </div>
</nav>

<style>
  /* 1. 强制容器：整体左对齐、垂直堆叠、紧贴正文 */
  nav {
    display: flex !important;
    flex-direction: column !important;
    align-items: flex-start !important; /* 核心：强制左对齐 */
    justify-content: flex-start !important;
    
    /* 距离调节：保持您满意的近距离 */
    margin-top: -1rem !important;    
    margin-bottom: 3rem !important;
    
    width: 100% !important;
    padding-left: 0 !important;        /* 确保不缩进，对齐正文边缘 */
    gap: 0.5rem !important;            /* 两行之间保持紧凑 */
  }

  /* 2. 第一行：Page X / Y (居左) */
  nav > div:first-child {
    display: block !important;
    text-align: left !important;
    width: auto !important;
    margin: 0 !important;
    padding: 0 !important;
    
    font-size: 10px !important;        /* 稍微缩小，显得更精致 */
    font-weight: bold !important;
    color: #a1a1aa !important;         /* 柔和的灰色，不喧宾夺主 */
    letter-spacing: 0.1em !important;
    text-transform: uppercase;
  }

  /* 3. 第二行：胶囊按钮容器 (居左) */
  nav > div.inline-flex {
    display: inline-flex !important;
    margin: 0 !important;              /* 彻底取消居中，强制靠左 */
    
    background-color: rgba(255, 255, 255, 0.9) !important;
    backdrop-filter: blur(8px);
    border: 1px solid rgba(0, 0, 0, 0.05) !important;
    padding: 2px !important;
    border-radius: 999px !important;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03) !important;
  }

  /* 4. 按钮样式：取消冗余边距，确保整齐 */
  .nav-link, .nav-disabled {
    @apply px-3 py-1.5 rounded-full text-xs font-medium no-underline flex items-center justify-center;
    text-decoration: none !important;
    border: none !important;
    min-width: 3.2rem !important;      /* 统一宽度，看起来更像“组件” */
  }

  .nav-link {
    @apply text-zinc-600 dark:text-zinc-400 hover:text-orange-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors;
  }

  .nav-disabled {
    @apply text-zinc-300 dark:text-zinc-700 cursor-not-allowed;
  }

  /* 5. 按钮间的细竖线微调 */
  nav div.bg-zinc-200 {
    height: 12px !important;           /* 缩短竖线，更透气 */
    margin: 0 4px !important;
    opacity: 0.5 !important;
  }
</style>
---
/* JS 逻辑部分保持完全一致 */
const { prev, next, current, total, base } = Astro.props;
if (!total || total <= 1) return null;

const ensureTrailingSlash = (url: string | undefined | null) => {
  if (!url) return null;
  return url.endsWith('/') ? url : `${url}/`;
};

const normalizedBase = base.endsWith('/') ? base : `${base}/`;
const firstPageUrl = normalizedBase;
const lastPageUrl = `${normalizedBase}${total}/`.replace(/\/+/g, '/');

let start = Math.max(1, current);
let end = Math.min(total, start + 9);
if (end - start < 9) { start = Math.max(1, end - 9); }
const range = Array.from({ length: (end - start) + 1 }, (_, i) => start + i);

let prevUrl = ensureTrailingSlash(prev);
if (prevUrl && (prevUrl === `${normalizedBase}1/` || prevUrl.endsWith('/1/'))) {
  prevUrl = normalizedBase;
}
const nextUrl = ensureTrailingSlash(next);
---

<nav class="pg-container" data-pagefind-ignore>
  <div class="pg-row">
    {/* 首页：手机端只显示符号 */}
    <a href={firstPageUrl} class={`pg-btn ${current === 1 ? 'is-disabled' : ''}`}>
      <span class="pc-only">首页</span><span class="m-only">«</span>
    </a>

    {/* 上一页箭头 */}
    <a href={prevUrl} class={`pg-btn arrow ${current === 1 ? 'is-disabled' : ''}`}>
      <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="m15 18l-6-6l6-6"/></svg>
    </a>

    {/* 数字区域：强制不换行 */}
    <div class="pg-numbers">
      {range.map((num) => (
        <a
          href={num === 1 ? firstPageUrl : `${normalizedBase}${num}/`}
          class={`pg-btn num ${current === num ? 'is-active' : ''}`}
        >
          {num}
        </a>
      ))}
    </div>

    {/* 下一页箭头 */}
    <a href={nextUrl} class={`pg-btn arrow ${current === total ? 'is-disabled' : ''}`}>
      <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="m9 18l6-6l-6-6"/></svg>
    </a>

    {/* 尾页：手机端只显示符号 */}
    <a href={lastPageUrl} class={`pg-btn ${current === total ? 'is-disabled' : ''}`}>
      <span class="pc-only">尾页</span><span class="m-only">»</span>
    </a>

    {/* 页码：1/19 紧跟其后 */}
    <span class="pg-info">{current}/{total}</span>
  </div>
</nav>

<style is:global>
  .pg-container {
    margin: 0rem 0;
    width: 80% !important;
    display: block !important;
  }

  .pg-row {
    display: flex !important;
    flex-wrap: nowrap !important; /* 核心：严禁换行 */
    align-items: center;
    gap: 0px; /* 间距由内部 padding 控制 */
  }

  .pg-numbers {
    display: flex !important;
    flex-wrap: nowrap !important;
  }

  .pg-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 28px;
    padding: 0 6px;
    font-size: 14px;
    color: #71717a !important;
    text-decoration: none !important;
    transition: all 0.2s;
    min-width: 22px;
  }

  .pg-btn.num {
    min-width: 24px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  }

  .pg-info {
    font-size: 11px;
    color: #a1a1aa;
    margin-left: 10px;
    white-space: nowrap;
  }

  /* 状态样式 */
  .pg-btn:not(.is-disabled):hover,
  .pg-btn.is-active {
    background-color: #27272a !important;
    color: #ea580c !important;
  }

  .is-disabled {
    opacity: 0.15;
    pointer-events: none;
  }

  /* 隐藏控制 */
  .m-only { display: none; }

  @media (max-width: 640px) {
    .pc-only { display: none; }
    .m-only { display: inline-block; font-weight: bold; font-size: 14px; }
    
    .pg-btn {
      height: 20px;
      padding: 0 3px;
      font-size: 14px;
      min-width: 20px;
    }
    
    .pg-btn.num {
      min-width: 20px;
    }

    .pg-info {
      margin-left: 5px;
      font-size: 10px;
    }
  }

  /* 针对极其狭窄的屏幕（如 iPhone SE）进一步压缩 */
  @media (max-width: 380px) {
    .pg-btn { padding: 0 2px; min-width: 16px; }
    .pg-info { display: none; } /* 实在放不下就隐藏统计 */
  }
</style>
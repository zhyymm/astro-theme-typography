---
const { prev, next, current, total, base } = Astro.props;
if (!total || total <= 1) return null;

const ensureTrailingSlash = (url: string | undefined | null) => {
  if (!url) return null;
  return url.endsWith('/') ? url : `${url}/`;
};

const normalizedBase = base.endsWith('/') ? base : `${base}/`;
const firstPageUrl = normalizedBase;
const lastPageUrl = `${normalizedBase}${total}/`.replace(/\/+/g, '/');

// --- 核心修正：路径破相，回归第一页真实路径 ---
let prevUrl = ensureTrailingSlash(prev);
if (prevUrl && (prevUrl === `${normalizedBase}1/` || prevUrl.endsWith('/1/'))) {
  prevUrl = normalizedBase;
}

const nextUrl = ensureTrailingSlash(next);
---

<nav class="flex flex-col items-center gap-5 mt-16 mb-12 font-sans">
  <div class="text-[10px] sm:text-xs uppercase tracking-[0.3em] text-zinc-400 dark:text-zinc-500 font-bold">
    Page {current} <span class="mx-1 opacity-40">/</span> {total}
  </div>

  <div class="inline-flex items-center bg-white/90 dark:bg-zinc-900/90 backdrop-blur-sm p-1.5 rounded-full border border-zinc-200 dark:border-zinc-800 shadow-sm transition-all hover:shadow-md">

    <div class="flex items-center">
      {current > 1 ? (
        <>
          <a href={firstPageUrl} class="nav-link">首页</a>
          <a href={prevUrl} class="nav-link px-3" title="上一页">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 18l-6-6l6-6"/></svg>
          </a>
        </>
      ) : (
        <>
          <span class="nav-disabled">首页</span>
          <span class="nav-disabled px-3"><svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-30" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 18l-6-6l6-6"/></svg></span>
        </>
      )}
    </div>

    <div class="w-[1px] h-5 bg-zinc-200 dark:bg-zinc-800 mx-1"></div>

    <div class="flex items-center">
      {current < total ? (
        <>
          <a href={nextUrl} class="nav-link px-3" title="下一页">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m9 18l6-6l-6-6"/></svg>
          </a>
          <a href={lastPageUrl} class="nav-link">尾页</a>
        </>
      ) : (
        <>
          <span class="nav-disabled px-3"><svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-30" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m9 18l6-6l-6-6"/></svg></span>
          <span class="nav-disabled">尾页</span>
        </>
      )}
    </div>
  </div>
</nav>

<style>
  /* 1. 强制容器：整体左对齐、垂直堆叠 */
  nav {
    display: flex !important;
    flex-direction: column !important;
    align-items: flex-start !important; 
    justify-content: flex-start !important;
    
    margin-top: -1rem !important;    
    margin-bottom: 4rem !important;
    
    width: 100% !important;
    padding-left: 0 !important;
    gap: 0.8rem !important;            /* 稍微拉开一点间距，更有呼吸感 */
  }

  /* 2. 第一行：Page 文字（同步正文字号） */
  nav > div:first-child {
    display: block !important;
    text-align: left !important;
    width: auto !important;
    margin: 0 !important;
    padding: 0 !important;
    
    /* 核心修改：同步正文字号 */
    font-size: 14px !important;        
    font-weight: 500 !important;       /* 中等字重，不至于太粗 */
    color: #71717a !important;         /* 对应 zinc-500，比正文稍浅 */
    letter-spacing: 0.05em !important;
    text-transform: none !important;   /* 取消全大写，回归自然排版 */
  }

  /* 3. 第二行：胶囊按钮容器 (居左) */
  nav > div.inline-flex {
    display: inline-flex !important;
    margin: 0 !important;
    background-color: rgba(255, 255, 255, 0.9) !important;
    backdrop-filter: blur(8px);
    border: 1px solid rgba(0, 0, 0, 0.05) !important;
    padding: 3px !important;
    border-radius: 999px !important;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.02) !important;
  }

  /* 4. 按钮样式 */
  .nav-link, .nav-disabled {
    @apply px-4 py-1.5 rounded-full text-sm font-medium no-underline flex items-center justify-center;
    text-decoration: none !important;
    border: none !important;
  }

  .nav-link {
    @apply text-zinc-600 dark:text-zinc-400 hover:text-orange-500 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors;
  }

  .nav-disabled {
    @apply text-zinc-300 dark:text-zinc-700 cursor-not-allowed;
  }

  /* 5. 竖线微调 */
  nav div.bg-zinc-200 {
    height: 14px !important;
    margin: 0 6px !important;
    opacity: 0.4 !important;
  }
</style>
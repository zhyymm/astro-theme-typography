---
// src/components/PostMeta.astro
import type { Post } from '~/types'
import { formatDate } from '~/utils'
import PostCategory from './PostCategory.astro'
import { generateSlug } from '~/utils/slugify'

interface Props {
  post: Post
}

interface LinkData {
    name: string;
    slug: string;
}

const { post } = Astro.props
const { translate: t } = Astro.locals

// 直接从文章数据中获取，不再需要 getEntry
const { author, authorName } = post.data

const categoryList: string[] = post.data.categories ?? []
const tagList: string[] = post.data.tags ?? []

const categoryLinkData: LinkData[] = categoryList.map((name: string) => {
    const generated = generateSlug(name);
    return { name, slug: (generated && generated.trim() !== '') ? generated : name };
});

const tagLinkData: LinkData[] = tagList.map((name: string) => {
    const generated = generateSlug(name);
    return { name, slug: (generated && generated.trim() !== '') ? generated : name };
});
---

<header flex="~ col gap-2">
  <h1 class="post-title">
      <a data-pagefind-meta="title" class="not-prose" href={`/posts/${post.slug || post.id}/`}>{post.data.title}</a>
  </h1>

  <div class="text-3.5 flex flex-wrap items-center gap-x-3 gap-y-1">
    <span>{t(post.data.modDate ? 'updated_at' : 'posted_at')}</span>
    <time>{formatDate(post.data.modDate ?? post.data.pubDate)}</time>

    {author && (
      <>
        <span class="opacity-30">·</span>
        <a
          href={`/authors/${author}/`}
          class="hover:text-orange-500 transition-colors opacity-60 hover:opacity-100"
        >
          {authorName || author}
        </a>
      </>
    )}

    {categoryLinkData.map((category) => (
      <div class="ml-2">
        <PostCategory category={{ name: category.name, slug: category.slug }} />
      </div>
    ))}

    {tagLinkData.length > 0 && (
      <>
        <span class="text-gray-400 mx-1">|</span>
        {tagLinkData.map((tag) => (
          <a href={`/tags/${encodeURIComponent(tag.slug)}/`} class="text-primary hover:underline whitespace-nowrap">
            #{tag.name}
          </a>
        ))}
      </>
    )}
  </div>
</header>
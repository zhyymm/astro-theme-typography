---
import { getCollection } from 'astro:content';
import LayoutDefault from '~/layouts/LayoutDefault.astro';
import LayoutPost from '~/layouts/LayoutPost.astro';
import Pagination from '~/components/Pagination.astro';
import { getPostDescription } from '~/utils';

export async function getStaticPaths({ paginate }) {
  // 1. 获取全体文章（不分标签，只除草稿）
  const allPosts = await getCollection('posts', ({ data }) => !data.draft);

  // 2. 按时间倒序排列
  const sortedPosts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

  // 3. 直接分页，不使用 flatMap 嵌套
  return paginate(sortedPosts, {
    pageSize: 10
  });
}

const { page } = Astro.props;
---

<LayoutDefault title="首页">
  <section class="flex flex-col gap-7.5 py-8">
    {page.data.map(post => (
      <LayoutPost post={post}>
       <p class="line-clamp-4 opacity-70 text-base mt-4 leading-relaxed">
          {getPostDescription(post)}
        </p>
      </LayoutPost>
    ))}
  </section>

  <Pagination
    prev={page.url.prev}
    next={page.url.next}
    current={page.currentPage}
    total={page.lastPage}
    base="/"
  />
</LayoutDefault>